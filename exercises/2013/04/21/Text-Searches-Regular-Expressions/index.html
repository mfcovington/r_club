<!DOCTYPE HTML>

<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Strings and Regular Expressions</title>
    <link rel="stylesheet" type="text/css" href="/r_club/stylesheets/pygment_trac.css">
    <link rel="stylesheet" type="text/css" href="/r_club/stylesheets/styles.css">
    <link rel="shortcut icon" href="/r_club/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/r_club/favicon.ico" type="image/x-icon">
    <script src="/r_club/javascripts/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=yes">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <script type="text/javascript">

      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-38722088-1']);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();

    </script>
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1 class="header"><a href="/r_club/">R Club</a></h1>
        <h2 class="header">Strings and Regular Expressions</h2>
      </header>
      <section>
        <div class = "duedate">
  
    <h3>due by: 2013-05-02</h3>
  
</div>

<div class = "related">
  
    
      
        
        
      
        
        
      
        
        
      
        
        
         related: <a href="/r_club/solutions/2013/05/01/Text-Searches-Regular-Expressions-Answers/">Strings and Regular Expressions Answers</a><br>
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
    
  
</div>

<div class = "author">
  
    posted by: Julin Maloof
  
</div>

<div class="content">
  <div id="post">
    <h1>String Searching and Manipulation</h1>

<p>R has extensive tools for searching for text (string) patterns and performing substitutions.  These can be very helpful in manipulation of large data sets.</p>

<p>These functions can search for exact matches or can make use of an extensive syntax for wildcards, known as <em>regular expressions</em>.  I will first describe the search functions and then explain regular expressions.</p>

<p>In this exercise, type all of the code blocks into your computer to see what happens!  Experiment as you go!</p>

<h2>Search Functions</h2>

<h3><code>grep()</code></h3>

<p>Use <em><code>grep()</code></em> when you want to search for a single pattern in a vector of strings.</p>
<div class="highlight"><pre><code class="r"><span class="c1"># for example: which state names have &#39;i&#39; in them?</span>
data<span class="p">(</span>state<span class="p">)</span>
state.name
<span class="c1"># in its basic form, grep returns the position (index) of the items that</span>
<span class="c1"># match the pattern.</span>
grep<span class="p">(</span>pattern <span class="o">=</span> <span class="s">&quot;i&quot;</span><span class="p">,</span> x <span class="o">=</span> state.name<span class="p">,</span> ignore.case <span class="o">=</span> <span class="k-Variable">T</span><span class="p">)</span>
<span class="c1"># you can also ask grep to return the values that match</span>
grep<span class="p">(</span>pattern <span class="o">=</span> <span class="s">&quot;i&quot;</span><span class="p">,</span> x <span class="o">=</span> state.name<span class="p">,</span> ignore.case <span class="o">=</span> <span class="k-Variable">T</span><span class="p">,</span> value <span class="o">=</span> <span class="k-Variable">T</span><span class="p">)</span>
</code></pre></div>
<p>The variant <em><code>grepl()</code></em> returns a logical vector of TRUE and FALSE indicating whether or not a match occurred.</p>
<div class="highlight"><pre><code class="r">grepl<span class="p">(</span>pattern <span class="o">=</span> <span class="s">&quot;i&quot;</span><span class="p">,</span> x <span class="o">=</span> state.name<span class="p">,</span> ignore.case <span class="o">=</span> <span class="k-Variable">T</span><span class="p">)</span>
<span class="c1"># recalling that TRUE = 1 and FALSE = 0, when can use grepl to quickly</span>
<span class="c1"># determine the number of states that have &#39;i&#39; in them.</span>
sum<span class="p">(</span>grepl<span class="p">(</span>pattern <span class="o">=</span> <span class="s">&quot;i&quot;</span><span class="p">,</span> x <span class="o">=</span> state.name<span class="p">,</span> ignore.case <span class="o">=</span> <span class="k-Variable">T</span><span class="p">))</span>
</code></pre></div>
<p><strong>Exercise 1:</strong> Can you figure out how to count the number of states that do not have an <code>i</code> in their name (without changing the search pattern)?  There are at least two easy ways.</p>

<h3><code>match()</code></h3>

<p>Use <em><code>match()</code></em> when you have two sets of values (lets call them Set A and Set B) and you want to know the (first) positions in Set B that match something that is in Set A.  Match only finds exact matches and can not be used with regular expressions.</p>
<div class="highlight"><pre><code class="r"><span class="c1"># we have a list of favorite fruits and a list of citrus.  Which of the</span>
<span class="c1"># favorites are citrus?</span>
favorites <span class="o">&lt;-</span> c<span class="p">(</span><span class="s">&quot;peach&quot;</span><span class="p">,</span> <span class="s">&quot;banana&quot;</span><span class="p">,</span> <span class="s">&quot;blueberry&quot;</span><span class="p">,</span> <span class="s">&quot;orange&quot;</span><span class="p">,</span> <span class="s">&quot;plum&quot;</span><span class="p">,</span> <span class="s">&quot;strawberry&quot;</span><span class="p">,</span> 
    <span class="s">&quot;mandarin&quot;</span><span class="p">)</span>
citrus <span class="o">&lt;-</span> c<span class="p">(</span><span class="s">&quot;kumquat&quot;</span><span class="p">,</span> <span class="s">&quot;grapefruit&quot;</span><span class="p">,</span> <span class="s">&quot;orange&quot;</span><span class="p">,</span> <span class="s">&quot;mandarin&quot;</span><span class="p">,</span> <span class="s">&quot;orange&quot;</span><span class="p">,</span> <span class="s">&quot;tangerine&quot;</span><span class="p">,</span> 
    <span class="s">&quot;tangelo&quot;</span><span class="p">,</span> <span class="s">&quot;lemon&quot;</span><span class="p">,</span> <span class="s">&quot;lime&quot;</span><span class="p">)</span>
match<span class="p">(</span>favorites<span class="p">,</span> citrus<span class="p">)</span>  <span class="c1">#what do the numbers returned refer to?</span>
</code></pre></div>
<p>Match has an alternative form which I find more convenient: <strong><code>%in%</code></strong>.  This form returns Trues or Falses indicating whether or not Set A is in Set B.</p>
<div class="highlight"><pre><code class="r">favorites <span class="o">%in%</span> citrus
<span class="c1"># most useful is to use this in combination with square brackets to</span>
<span class="c1"># extract</span>
favorites<span class="p">[</span>favorites <span class="o">%in%</span> citrus<span class="p">]</span>
</code></pre></div>
<h3><code>sub()</code></h3>

<p><strong><code>sub()</code></strong> performs text substitutions.  Think of it as find and replace.</p>
<div class="highlight"><pre><code class="r"><span class="c1"># lets say that we wanted to replace &#39;W&#39; with the phrase &#39;_DoubleU_&#39;</span>
sub<span class="p">(</span><span class="s">&quot;w&quot;</span><span class="p">,</span> <span class="s">&quot;_DoubleU_&quot;</span><span class="p">,</span> state.name<span class="p">,</span> ignore.case <span class="o">=</span> <span class="k-Variable">T</span><span class="p">)</span>
</code></pre></div>
<p><strong>Excerise 2:</strong> Try replacing all instances of <code>i</code> with <code>y</code>.  Are results what you expected? Why or why not?</p>

<h3><code>gsub()</code></h3>

<p><code>sub()</code> only replaces the first occurrence of <em>pattern</em>.  <strong><code>gsub()</code></strong> will replace all occurrences.</p>
<div class="highlight"><pre><code class="r">gsub<span class="p">(</span><span class="s">&quot;i&quot;</span><span class="p">,</span> <span class="s">&quot;y&quot;</span><span class="p">,</span> state.name<span class="p">,</span> ignore.case <span class="o">=</span> <span class="k-Variable">T</span><span class="p">)</span>
<span class="c1"># compare to just using sub()</span>
</code></pre></div>
<h2>Regular Expressions</h2>

<p>Regular expressions (regexp) are a way of specifying wild cards in the search operations described above. The same syntax (with some modifications) is used in many computer languages including Unix/Linux command line tools, Perl, python, and very helpfully SublimeText2.</p>

<h3>Character classes I</h3>

<p>Regexp have codes to match certain <em>classes</em> of characters.</p>

<ul>
<li><code>.</code>  Matches any single character</li>
<li><code>\\w</code> Matches any character that would be found in a &quot;word&quot; including digits (excludes punctuation and white space)</li>
<li><code>\\W</code> Is the opposite of <code>\\w</code> and matches any non-word character</li>
<li><code>\\d</code> Matches any digit character</li>
<li><code>\\D</code> Matches any non-digit character</li>
<li><code>\\s</code> Matches any white space character</li>
<li><code>\\S</code> Matches any non space character</li>
</ul>

<p>The following match specific characters or locations but are worth mentioning here:</p>

<ul>
<li><code>^</code>  Matches the beginning of a line</li>
<li><code>$</code>  Matches the end of a line</li>
<li><code>\t</code> tab character</li>
<li><code>\n</code> return character</li>
</ul>

<p>Unless you use additional modifications described below, these match a single character.</p>

<p>How would we find state names that have two <code>a</code>s separated by a single additional character?</p>
<div class="highlight"><pre><code class="r">data<span class="p">(</span>state<span class="p">)</span>
grep<span class="p">(</span><span class="s">&quot;a.a&quot;</span><span class="p">,</span> state.name<span class="p">,</span> value <span class="o">=</span> <span class="k-Variable">T</span><span class="p">,</span> ignore.case <span class="o">=</span> <span class="k-Variable">T</span><span class="p">)</span>
</code></pre></div>
<p><strong>Exercise 3:</strong> Find state names that have a space in their names.</p>

<p><strong>Exercise 4:</strong> Find state names that begin with <code>M</code></p>

<h3>Character classes II</h3>

<p>An alternative way of specifying character classes is to enclose them in square brackets.</p>

<p>For example, to find all of the state names that end with a vowel:</p>
<div class="highlight"><pre><code class="r">grep<span class="p">(</span><span class="s">&quot;[aeiou]$&quot;</span><span class="p">,</span> state.name<span class="p">,</span> value <span class="o">=</span> <span class="k-Variable">T</span><span class="p">)</span>
</code></pre></div>
<p>The <code>^</code> sign inside of square brackets inverts the search.</p>

<p><strong>Exercise 5:</strong> Find state names that begin with non-vowels.</p>

<p>You can specify ranges of characters inside square brackets:</p>

<ul>
<li><code>[0-9]</code> : all digits</li>
<li><code>[a-j]</code> : the first 10 (lowercase) letters of the alphabet</li>
</ul>

<p>There are also a number of predefined character classes.  For example:</p>

<p><code>[:punct:]</code> (punctuation characters):</p>
<div class="highlight"><pre><code class="text">! &quot; # $ % &amp; &#39; ( ) * + , - . / : ; &lt; = &gt; ? @ [ \ ] ^ _ ` { | } ~
</code></pre></div>
<p>See <code>?regex</code> for additional classes.</p>

<p>Perhaps confusingly these classes must themselves be placed within square brackets (e.g., <code>[[:punct:]]</code>)</p>
<div class="highlight"><pre><code class="r">grep<span class="p">(</span><span class="s">&quot;[[:space:]]&quot;</span><span class="p">,</span> state.name<span class="p">,</span> value <span class="o">=</span> <span class="k-Variable">T</span><span class="p">)</span>
</code></pre></div>
<h3>Specifying repeats</h3>

<p>You can specify the number of times that a character or character class is repeated.</p>

<ul>
<li><code>?</code>     The preceding item is optional and will be matched at most once.</li>
<li><code>*</code>     The preceding item will be matched zero or more times.</li>
<li><code>+</code>     The preceding item will be matched one or more times.</li>
<li><code>{n}</code>   The preceding item is matched exactly n times.</li>
<li><code>{n,}</code>  The preceding item is matched n or more times.</li>
<li><code>{n,m}</code> The preceding item is matched at least n times, but not more than m times.</li>
</ul>

<p><strong>Exercise 6:</strong> Find the state names that have two consecutive vowels in them.</p>

<p><strong>Exercise 7:</strong> Using last weeks data set, count the number of babys with the name Stacey or Stacy.  Bonus 1: count Stacey, Stacy, or Staci.  Bonus 2 list the unique set of names that start with <code>Stac</code>.  The data set can be <a href="http://plyr.had.co.nz/09-user/plyr-tutorial.zip">downloaded here</a></p>

<h3>Alternates</h3>

<p>The <code>|</code> character can be read as &quot;or&quot; and can be used to specify alternates.</p>
<div class="highlight"><pre><code class="r"><span class="c1"># Example: change the path below to point to &#39;bnames.csv&#39; on your computer</span>
bnames <span class="o">&lt;-</span> read.csv<span class="p">(</span><span class="s">&quot;~/Documents/Teaching/RClub/plyr-tutorial/examples/bnames.csv&quot;</span><span class="p">,</span> 
    as.is <span class="o">=</span> <span class="k-Variable">T</span><span class="p">)</span>
bnames<span class="p">[</span>grep<span class="p">(</span><span class="s">&quot;Stac(y|i)&quot;</span><span class="p">,</span> bnames<span class="o">$</span>name<span class="p">),</span> <span class="p">]</span>
</code></pre></div>
<p><strong>Exercise 8:</strong> Pull out the names &quot;Jonathan&quot; &quot;Jonnie&quot; and &quot;Jonathon&quot; but not other Jon names.  Bonus: Only have Jon listed once in your search string.</p>

<h3>Escapes</h3>

<p>What if you want to match a <code>.</code> or other special character?  The following characters have special meaning in regular expressions: <code>. \ | ( ) [ { ^ $ * + ?</code> and if you want to search for them you have to do something special.</p>
<div class="highlight"><pre><code class="r"><span class="c1"># say you want all Chrom one ILs</span>
ILs <span class="o">&lt;-</span> c<span class="p">(</span><span class="s">&quot;IL.1.1&quot;</span><span class="p">,</span> <span class="s">&quot;IL.2.2&quot;</span><span class="p">,</span> <span class="s">&quot;IL.1.3&quot;</span><span class="p">,</span> <span class="s">&quot;IL.2.1&quot;</span><span class="p">,</span> <span class="s">&quot;IL.11.1&quot;</span><span class="p">,</span> <span class="s">&quot;IL.11.3&quot;</span><span class="p">,</span> <span class="s">&quot;IL.12.1&quot;</span><span class="p">,</span> 
    <span class="s">&quot;IL.12.2&quot;</span><span class="p">)</span>
<span class="c1"># the following seems logical at first:</span>
grep<span class="p">(</span><span class="s">&quot;IL.1.&quot;</span><span class="p">,</span> ILs<span class="p">,</span> value <span class="o">=</span> <span class="k-Variable">T</span><span class="p">)</span>
</code></pre></div>
<p>What happened?  Remember that <code>.</code> matches any character.  We need to tell grep that the <code>.</code> is just a regular character, not a wildcard. To do this we &quot;escape&quot; it by preceding it with a <code>\</code>.  However, since <code>\</code> itself is a special character it must also be escaped. So we use two backslashes.</p>
<div class="highlight"><pre><code class="r">grep<span class="p">(</span><span class="s">&quot;IL\\.1\\.&quot;</span><span class="p">,</span> ILs<span class="p">,</span> value <span class="o">=</span> <span class="k-Variable">T</span><span class="p">)</span>
<span class="c1"># an alternative, if you don&#39;t need any regex functionality is to use the</span>
<span class="c1"># argument &#39;fixed=T&#39;</span>
grep<span class="p">(</span><span class="s">&quot;IL.1.&quot;</span><span class="p">,</span> ILs<span class="p">,</span> value <span class="o">=</span> <span class="k-Variable">T</span><span class="p">,</span> fixed <span class="o">=</span> <span class="k-Variable">T</span><span class="p">)</span>
</code></pre></div>
<h3>Back references</h3>

<p>One of the powerful tools in regexps is the ability to refer back to a previous match.  The item that you want to refer back to is enclosed in parentheses.  You backreference with a backslash and a digit.  A <code>\\1</code> would indicate the first group enclosed in a parentheses, a <code>\\2</code> would refer to the second group, etc.</p>

<p>Suppose we want to find all state names that have letters repeated twice in a row.</p>
<div class="highlight"><pre><code class="r">grep<span class="p">(</span><span class="s">&quot;(.)\\1&quot;</span><span class="p">,</span> state.name<span class="p">,</span> value <span class="o">=</span> <span class="k-Variable">T</span><span class="p">)</span>
<span class="c1"># the &#39;.&#39; matches any character.  Enclosing that in parentheses designates</span>
<span class="c1"># it as an item that we want to refer back to.  The \\1 refers back to</span>
<span class="c1"># it.</span>
</code></pre></div>
<p><strong>Exercise 9:</strong> Find all state names that have two vowels repeated.</p>

<p>I find back references particularly helpful in combination with <code>sub()</code>, because you can use them in your replacement string.</p>

<p><strong>Exercise 10:</strong> For all two-worded state names reverse the order of the two words and add a comma between the words.  (&quot;North Carolina&quot; should become &quot;Carolina, North&quot;)</p>

<p><strong>Exercise 11:</strong> For all two-worded state names, abbreviate the first word to be the first letter, followed by a <code>.</code> (&quot;North Carolina&quot; becomes &quot;N. Carolina&quot;).</p>

  </div>
</div>


  <div id="disqus_thread"></div>
  <script type="text/javascript">
      /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
      var disqus_shortname = 'rclub'; // required: replace example with your forum shortname

      /* * * DON'T EDIT BELOW THIS LINE * * */
      (function() {
          var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
          dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
          (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      })();
  </script>
  <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>


      </section>
      <footer>

        <div class="categories">
          
          <h3>Categories</h3>
          
            <h4><a href="/r_club/homework">homework (4)</a></h4>
            <ul>
              
                <li><a href="/r_club/homework/2013/03/29/Data-Types-and-Reshape-homework/">Homework--Data Types and Reshape</a></li>
              
                <li><a href="/r_club/homework/2013/03/04/elaborate-upon-plot/">Elaborate upon a plot</a></li>
              
            </ul>
          
            <h4><a href="/r_club/exercises">exercises (3)</a></h4>
            <ul>
              
                <li><a href="/r_club/exercises/2013/05/02/more-regex/">More Regular Expressions...</a></li>
              
                <li><a href="/r_club/exercises/2013/04/21/Text-Searches-Regular-Expressions/">Strings and Regular Expressions</a></li>
              
            </ul>
          
            <h4><a href="/r_club/solutions">solutions (5)</a></h4>
            <ul>
              
                <li><a href="/r_club/solutions/2013/05/01/Text-Searches-Regular-Expressions-Answers/">Strings and Regular Expressions Answers</a></li>
              
                <li><a href="/r_club/solutions/2013/04/03/Data-Types-and-Reshape-Answers/">Homework--Data Types and Reshape</a></li>
              
            </ul>
          
            <h4><a href="/r_club/resources">resources (7)</a></h4>
            <ul>
              
                <li><a href="/r_club/resources/2013/05/02/regex-resources/">Regex Resources</a></li>
              
                <li><a href="/r_club/resources/2013/03/28/Reshape/">Reshape</a></li>
              
            </ul>
          

          
          
            
            
          
            
            
          
            
            
              
            
          
            
            
          
            
            
              
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
              
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
              
            
          
            
            
          
            
            
          
            
            
              
            
          
            
            
          
            
            
              
            
          
            
            
          
            
            
          
            
            
              
            
          
            
            
          
            
            
              
            
          
            
            
              
            
          
            
            
              
            
          
            
            
              
            
          
            
            
              
            
          
            
            
              
            
          
            
            
              
            
          
            
            
              
            
          
          <h4><a href="/r_club/other">other (15)</a></h4>

          <ul>
            
              
              
            
              
              
            
              
              
                
                
                    <li><a href="/r_club/schedule/2013/05/02/2013-05-02/">2013 05 02</a></li>
                
              
            
              
              
            
              
              
                
                
                    <li><a href="/r_club/schedule/2013/04/25/2013-04-25/">2013 04 25</a></li>
                
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
                
                
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
                
                
              
            
              
              
            
              
              
            
              
              
                
                
              
            
              
              
            
              
              
                
                
              
            
              
              
            
              
              
            
              
              
                
                
              
            
              
              
            
              
              
                
                
              
            
              
              
                
                
              
            
              
              
                
                
              
            
              
              
                
                
              
            
              
              
                
                
              
            
              
              
                
                
              
            
              
              
                
                
              
            
              
              
                
                
              
            
          </ul>
        </div>

      </footer>
    </div>
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->

  </body>
</html>
